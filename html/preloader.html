<!DOCTYPE HTML>
<html>
<head>
  <title>–ó–∞—á–µ–∫–∞–π—Ç–µ...</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <button id="startAudio" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; opacity: 5; z-index: 9999; background: transparent; border: none;">
    <span id="startText" style="display: inline-block; transform: translateY(-300px); color: #963650; font-size: 36px;">
      –ü—Ä–∏–∫–ª–∞–¥–∏ –ª–∞–ø–∫—É üíî
    </span>
  </button>
  <audio id="bgMusic" src="../music/sad_prev.mp3" loop></audio>
  
  <style>
    html, body, * {
      cursor: url('../img/cursor.svg') 16 16, auto;
    }
    body {
      margin: 0;
      padding: 0;
      background: #fdc9d1;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #preloader {
      text-align: center;
    }
    #preloader h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }
    #preloader p {
      font-size: 1.2em;
    }
    #preloader img {
      max-width: 100%;
      margin-bottom: 20px;
    }
    #countdownTimer {
      margin-top: 20px;
      font-size: 6em;
      color: #963650;
    }
    #countdownTimer.lastTen {
      animation: blink 1s steps(2, start) infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
  </style>
  
  <script>
    function fadeOut(audio, duration, callback) {
      var interval = 50;
      var steps = duration / interval;
      var stepVolume = audio.volume / steps;
      var fadeInterval = setInterval(function() {
        audio.volume = Math.max(0, audio.volume - stepVolume);
        if (audio.volume <= 0) {
          clearInterval(fadeInterval);
          if (callback) callback();
        }
      }, interval);
    }
    
    function fadeIn(audio, targetVolume, duration, callback) {
      audio.volume = 0;
      var interval = 50;
      var steps = duration / interval;
      var stepVolume = targetVolume / steps;
      var fadeInterval = setInterval(function() {
        audio.volume = Math.min(targetVolume, audio.volume + stepVolume);
        if (audio.volume >= targetVolume) {
          clearInterval(fadeInterval);
          if (callback) callback();
        }
      }, interval);
    }
    // –¶—ñ–ª—å–æ–≤–∏–π —á–∞—Å ‚Äì –µ—Ç–∞–ø "–©–µ —Ç—Ä—ñ—à–∫–∏... –≤—Å–µ —Å–∫–æ—Ä–æ –±—É–¥–µ" (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 14 –ª—é—Ç–æ–≥–æ 2025, 10:02:30)
    var targetTime = new Date(2025, 1, 14, 10, 2, 30);
    var timerStart = new Date(targetTime.getTime() - 120 * 1000);
    
    function updateCountdown() {
      var now = new Date();
      var remaining = targetTime - now;
      if (remaining < 0) remaining = 0;
      var timerElem = document.getElementById("countdownTimer");
      if (timerElem) {
        if (remaining < 10000) {
          var seconds = Math.floor(remaining / 1000);
          timerElem.innerText = seconds;
          timerElem.classList.add("lastTen");
        } else {
          var minutes = Math.floor(remaining / 60000);
          var seconds = Math.floor((remaining % 60000) / 1000);
          var timeStr = minutes + ":" + seconds;
          timerElem.innerText = timeStr;
          timerElem.classList.remove("lastTen");
        }
      }
    }
    
    function checkPreloaderTime() {
      var now = new Date();
      console.log("preloader.html: –ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å:", now, "–¶—ñ–ª—å–æ–≤–∏–π —á–∞—Å:", targetTime);
      
      if (now < targetTime) {
        console.log("preloader.html: –©–µ —Ä–∞–Ω–æ, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥.");
        setTimeout(checkPreloaderTime, 10000);
      } else {
        console.log("preloader.html: –ß–∞—Å –Ω–∞—Å—Ç–∞–≤. –ü–µ—Ä—à–∏–π –µ—Ç–∞–ø ‚Äì '–©–µ —Ç—Ä—ñ—à–∫–∏... –≤—Å–µ —Å–∫–æ—Ä–æ –±—É–¥–µ'.");
        var preloaderDiv = document.getElementById("preloader");
        preloaderDiv.innerHTML = '<img src="../img/loading2.gif" alt="–ì–æ—Ç–æ–≤–æ"><h1>–©–µ —Ç—Ä—ñ—à–∫–∏... –≤—Å–µ —Å–∫–æ—Ä–æ –±—É–¥–µ</h1>';
        var bgMusic = document.getElementById("bgMusic");
        fadeOut(bgMusic, 2000, function() {
          bgMusic.pause();
          bgMusic.currentTime = 0;
          bgMusic.src = "../music/preload_track.mp3";
          bgMusic.load();
          bgMusic.loop = true;
          bgMusic.play().then(() => {
            fadeIn(bgMusic, 1, 2000);
          }).catch((error) => {
            console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É –Ω–æ–≤–æ–≥–æ —Ç—Ä–µ–∫—É:", error);
          });
        });
        
        setTimeout(function(){
          console.log("preloader.html: –î—Ä—É–≥–∏–π –µ—Ç–∞–ø ‚Äì '–¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è'.");
          preloaderDiv.innerHTML = '<img src="../img/ready.png" alt="–ì–æ—Ç–æ–≤–æ"><h1>–¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è</h1>';
          
          fadeOut(bgMusic, 2000, function() {
            bgMusic.pause();
            bgMusic.currentTime = 0;
            bgMusic.src = "../music/final_track.mp3"; 
            bgMusic.load();
            bgMusic.loop = true;
            bgMusic.play().then(() => {
              fadeIn(bgMusic, 1, 3000);
            }).catch((error) => {
              console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–∫—É:", error);
            });
          });
          setTimeout(function(){
            console.log("preloader.html: –ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ project3.html.");
            window.location.href = "project3.html";
          }, 20000);
        }, 30000);
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      checkPreloaderTime();
      
      var timerInterval = setInterval(function(){
        var now = new Date();
        if (now >= timerStart && now < targetTime) {
          if (!document.getElementById("countdownTimer")) {
            var timerElem = document.createElement("div");
            timerElem.id = "countdownTimer";
            timerElem.style.marginTop = "20px";
            timerElem.style.fontSize = "6em";
            timerElem.style.color = "#963650";
            document.getElementById("preloader").appendChild(timerElem);
          }
          updateCountdown();
        }
        if (now >= targetTime) {
          clearInterval(timerInterval);
        }
      }, 1000);
    }, false);
  </script>
</head>
<body>
  <div id="preloader">
    <img id="loadingGif" src="../img/loading.gif" alt="Loading...">
    <h1>–ó–∞—á–µ–∫–∞–π—Ç–µ...</h1>
    <p>–¶—é —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –ø—ñ—Å–ª—è 10:00 14 –ª—é—Ç–æ–≥–æ</p>
  </div>
  
  <script>
    document.getElementById("startAudio").addEventListener("click", function() {
      const bgMusic = document.getElementById("bgMusic");
      bgMusic.play().then(() => {
        console.log("–§–æ–Ω–æ–≤–∞ –º—É–∑–∏–∫–∞ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å");
      }).catch((error) => {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É –º—É–∑–∏–∫–∏:", error);
      });
      this.remove();
    });
  </script>
</body>
</html>
